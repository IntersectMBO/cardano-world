Issues organized by milestone.

Timeline:
1. staging: internal testnet
2. testnet: public testnet
3. mainnet 2.0: Byron compatible
4. mainnet 2.1: Shelley -- centralized (has stake pools)
   decentralization of the block creation, but not network topology
5. mainnet 2.2: Shelley -- decentralization at the network level
   decentralization of the network infrastructure

# Storage layer

## Supporting infrastructure

- [X] #193 Consensus_On Disk Representation [DUP]
- [X] #203 Support for explorer [WONTFIX]

## FS bindings and simulation

- [X] #208 Bug in removeFile or its tests bug
- [X] #166 Take another look at trying to remove the ExceptT from the HasFS stack
- [X] #277 Correctly deal with partial reads and writes
- [X] #285 Implement Windows-specific parts
- [X] #292 Support O_EXCL in posix bindings
- [X] #502 Mock FS system: deal with non-deterministic hGetSome and hPutSome [WONTFIX]

- [ ] #305 Make sure IO HasFS wrapper includes mount point in error messages
- [ ] #556 Verify blocking behaviour of the low-level IO primitives

### Improvements/testing

- [ ] #398 Delete remaining unit test
- [ ] #532 Make `ioToFsError` OS specific

## Immutable DB

- [X] #141 Make immutable DB epoch type configurable
- [X] #205 Implement immutable block storage
- [X] #241 Remove `EpochSlot` and `RelativeSlot` from Immutable DB interface
- [X] #278 Simulate corruptions of on-disk files of the immutable DB
- [X] #291 Test all recovery policies of the immutable DB
- [X] #328 Close open iterators when the immutable DB is closed or truncated [WONTIFX]
- [X] #344 Immutable DB: Support EBBs? [DUP]
- [X] #349 Handle EBBs explicitly in the `ImmutableDB`
- [X] #369 Inclusive/exclusive iterator bounds for the ImmutableDB [DUP of #439]
- [X] #372 Immutable DB: Add `getBlockAtTip` API call [WONTFIX]
- [X] #384 Let the ImmutableDB return lazy ByteStrings

- [ ] #379 Immutable DB: Audit memory footprint

### Improved testing/minor improvements

- [ ] #290 Simulate random bit flip corruptions for the immutable DB
- [ ] #338 Use `Vector` rather than `Seq` to store culumative epoch sizes in immutable DB
- [ ] #428 Cleanup exception handling
- [ ] #501 Immutable DB does not support incremental decoders
- [ ] #548 Immutable DB: allow streaming from and to exclusive bounds
- [ ] #646 Immutable DB: simulate and test with an upper bound on number of file handles
- [ ] #648 Immutable DB: verify that no file handles are leaked
- [ ] #650 Immutable DB: simulate failed file handle closes

## Volatile DB

- [x] #202 Volatile block storage
- [x] #251 Volatile DB: add labelling
- [x] #252 Volatile DB: Extend q-s-m tests to test reopening
- [x] #253 Volatile DB: Migrate unit tests to q-s-m tests
- [x] #273 Volatile DB: Check against simulated errors
- [x] #373 Volatile DB: Add fingerprint [WONTFIX]
- [x] #430 Volatile DB: Duplicate Blocks [WONTFIX]
- [x] #435 uncover STM transactions of some VolatileDB api calls
- [x] #450 Vol DB: `getIsMember` should not return a `Maybe`
- [x] #463 Volatile DB: make getIsMember transactional
- [x] #488 Volatile DB: Make parser error type variable

- [ ] #378 Volatile DB: Audit memory footprint
- [ ] #647 Volatile DB: simulate and test with an upper bound on number of file handles
- [ ] #649 Volatile DB: verify that no file handles are leaked
- [ ] #651 Volatile DB: simulate failed file handle closes

## Ledger DB

- [X] #200 Ledger state storage
- [X] #247 Ledger storage: q-s-m tests
- [X] #368 Unify the Tip of the ImmutableDB with the Tip of the LedgerDB

- [ ] #367 Ledger DB: Thread for writing snapshots
- [ ] #626 Ledger DB: test with invalid blocks

## Chain DB

- [X] #296 Chain DB: Move blocks from immutable DB to mutable DB on corruption [WONTFIX]

- [ ] #201 Chain DB
- [ ] #242 Chain DB: Truncate chain when gap arises between immutable DB and volatile DB
- [ ] #246 Chain DB: q-s-m tests
- [ ] #380 Chain DB: Audit memory footprint
- [ ] #445 Chain DB: Protect against unintended file deletion
- [ ] #625 Chain DB: Test with invalid blocks
- [ ] #627 Chain DB: Profile memory usage of chain selection
- [ ] #653 Chain DB: test with corruption
- [ ] #693 Chain DB: property tests for the model

### Improvements

- [ ] #392 Chain DB: Instruct immutable DB to verify previous epoch file once closed
- [ ] #504 Chain DB: Support tentative header
- [ ] #505 Increase sharing for in-memory headers

## Use storage system in consensus layer

- [X] #266 Write chainSyncServer that uses on-disk storage

- [ ] #245 Actually use on-disk storage

# Perm_BFT

- [X] #197 Consensus_OBFT Permissive Impl [DUP]
- [X] #168 Implement permissive BFT [WONTFIX]
- [X] #274 Implement PermBFT in terms of "real" implementation
- [X] #309 Chain selection: prefer higher issue number (DUP)
- [X] #422 Implement PBFT chain selection rule [WONTFIX]

- [ ] #308 Core/Edge split

# Integrate ledger

- [X] #191 Integrate pre-Shelley era ledger
- [X] #238 Run protocol tests with "proper" blocks generated by ledger layer generators [WONTFIX]
- [X] #255 Carefully think through order of updates
- [X] #590 Avoid using show to implement Ord for keys [WONTFIX]
- [X] #618 Change `HasSignTag` for `ToSign`

- [ ] #250 Run tests with real real blocks
- [ ] #440 Introduce "already validated" flag for ledger layer and use it
- [ ] #539 Ledger integration - incorporate epoch boundary blocks.
- [ ] #591 Review Byron implementation with formal spec team
- [ ] #592 Extend definition of generalized transaction for Byron
- [ ] #595 Implement "header matches block"
- [ ] #596 Reconsider `UpdateLedger`

# Header-Body split

- [X] #189 Consensus_Incorporate Network Layer (Header/Body Split) [DUP]
- [X] #243 Update network abstraction for header/body split
- [X] #244 Header validation without corresponding bodies

## Chain Sync Client

- [X] #472 Chain Sync Client: make sure the HeaderState and LedgerState don't drift too far apart [WONTFIX]
- [X] #573 Chain Sync Client: pause when headers run away from ledger tip

- [ ] #264 Chain Sync Client: Handle rollback due to disk corruption
- [ ] #465 Chain Sync Client: trim candidate chains
- [ ] #466 Chain Sync Client: disconnect from nodes with invalid blocks
- [ ] #579 Chain Sync Client: maintain "forks within k" invariant
- [ ] #580 Chain Sync Client: pipelined version
- [ ] #581 Chain Sync Client: Reuse anachronistic ledger view?
- [ ] #593 Chain Sync Client: instantiate with header and BlockSize

## Chain Sync Server

- [ ] #661 ChainSync server should read the current tip when sending updates

## Stretch goals

- [ ] #423 Chain Sync Client: rate limiting
- [ ] #467 Chain Sync Client: switch to their head if possible

# Mempool

- [X] #265 Implement mempool
- [X] #668 Mempool: Ensure getTxs does not update internal state
- [X] #695 Mempool: Introduce snapshot functionality

- [ ] #621 Mempool: impose maximum capacity
- [ ] #622 Mempool: expire transactions
- [ ] #669 Mempool: Introduce event tracing
- [ ] #685 Mempool: Return all attempted transactions from addTxs
- [ ] #686 Mempool: Utilize tx size in TxSeq FingerTree
- [ ] #692 Mempool: Fix TicketNo counter implementation
- [ ] #700 Mempool: Introduce and implement GenTxSize

# Standalone Node

- [X] #132 Fix demo playground
- [X] #222 Make sure the demo can work when fewer than 3 nodes present
- [X] #223 Fix cleanup of named pipes in demo
- [X] #267 Ongoing: integrate features implemented elsewhere into standalone node
- [X] #280 Deal correctly with time

- [ ] #624 Demo: add initial stake to mock ledger
- [ ] #702 Clean `Ouroboros.Consensus.Demo`
- [ ] #705 Demo playground not syncing correctly

# Testing

- [X] #195 Consensus_Test Consensus Protocols [DUP]

- [ ] #228 Protocol testing: Test with different network topologies
- [ ] #229 Protocol testing: introduce network latencies
- [ ] #230 Protocol testing: test network partitioning
- [ ] #231 Protocol testing: test what happens when nodes join the network much later
- [ ] #232 Protocol testing: test what happens when nodes join and leave the network repeatedly
- [ ] #233 Introduce explicit adversaries
- [ ] #234 Test Praos/genesis with explicit leader schedules
- [ ] #235 Protocol testing: test chain growth
- [ ] #236 Protocol testing: test chain quality
- [ ] #237 Protocol testing: check liveness
- [ ] #269 Protocol testing: recovery from disk failure
- [ ] #470 Protocol testing: test what happens when blocks don't match their headers
- [ ] #553 Protocol testing: header/body split
- [ ] #569 Use coverage checking in consensus tests

# Shelley

NOTE: Responsibility for the following tickets is partly the consensus team
and partly the ledger team:

* #192
* #199
* #216
* #219
* #261
* #262

## Ledger

- [ ] #258 Integrate post-Shelley era ledger

## Praos

- [X] #131 Praos test failure
- [X] #196 Consensus_Praos Impl
- [X] #206 Update Praos after investigation on representation of fractional numbers [DUP]
- [X] #293 Don't allow for blocks in the future
- [X] #263 Rethink division of work between consensus layer and ledger layer

- [ ] #216 Incorporate decisions regarding floating point in Praos calculations
- [ ] #248 Keep `ChainState` bounded in size
- [ ] #261 Integrate real crypto
- [ ] #262 Support lightweight delegation certificates

## Genesis

- [X] #194 Consensus_Exec Spec Ourborous Genesis [DUP]
- [ ] #199 Make sure that our implementation of genesis is compatible with the paper
- [ ] #219 Work out detailed description of genesis chain selection rule
- [ ] #220 Implement genesis chain selection rule
- [ ] #221 Update chain sync client for genesis chain selection rule

## Transition

- [ ] #192 Implement PermBFT -> Praos transitional protocol
- [ ] #282 Support multiple slot lengths
- [ ] #226 EpochInfo: Use ledger to figure out epoch lengths
- [ ] #259 Integrate/test ledger integration across the Shelley hard fork

# Clean up technical debt

- [X] #224 Reintroduce `QuantifiedConstraints` [WONTFIX]
- [X] #227 Replace remaining unit tests for the mock file system
- [X] #587 Technical debt: reintroduce quantified constraints [DUP]
- [X] #588 Technical debt: be consistent with `hdr blk` versus `blk hdr`
- [X] #589 Technical debt: introduce `Header` type family
- [X] #612 Technical debt: move `Ouroboros.Consensus.Demo.*` to separate package

- [ ] #322 Take advantage of new async infrastructure
- [ ] #254 Generalize q-s-m framework
- [ ] #225 Replace remaining unit tests for immutable DB
- [ ] #483 Clean up test blocks
- [ ] #694 Move ChainProducerState from network to consensus
- [ ] #709 Define constrName and constrNames once