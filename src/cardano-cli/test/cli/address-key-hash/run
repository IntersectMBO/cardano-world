#!/bin/sh -u

cwd=$(dirname "$0")

# shellcheck source=/dev/null
. "${cwd}/../core/common"

# shellcheck disable=SC2154
banner "${testname}"

error=0

# Generate a key pair
${CARDANO_CLI} shelley address key-gen \
    --verification-key-file "${TEST_DIR}/address.vkey" \
    --signing-key-file "${TEST_DIR}/address.skey"

assert_file_exists "${TEST_DIR}/address.vkey"

count=$(grep -c VerificationKeyShelley "${TEST_DIR}/address.vkey")
if test "${count}" != 1 ; then
  echo "${TEST_DIR}/address.vkey: Expected VerificationKeyShelley"
  error=1
  fi


# Now generate the hash.
${CARDANO_CLI} shelley address key-hash \
    --verification-key-file "${TEST_DIR}/address.vkey" \
    > "${TEST_DIR}/vkey-hash"

assert_file_exists "${TEST_DIR}/vkey-hash"

assert_line_count 1 "${TEST_DIR}/vkey-hash"

report_result ${error}
